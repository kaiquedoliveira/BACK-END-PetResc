generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id       Int    @id @default(autoincrement())
  email    String @unique
  password String
  role     Role

  nome                      String
  cpf                       String   @unique
  telefone                  String?
  animaisVistosRecentemente String[]

  cep         String?
  rua         String?
  numero      String?
  complemento String?
  bairro      String?
  cidade      String?
  estado      String?

  resetToken       String?
  resetTokenExpiry DateTime?

  // Relações com perfis que têm dados EXCLUSIVOS
  admin   Admin?
  ong     Ong?
  publico Publico?

  favoritos               Favorito[]
  doacoes                 Doacao[]
  larTemporarios          LarTemporario[]
  animals                 Animal[]
  pedidosAdocao           PedidoAdocao[]  @relation("CandidatoPedidos")
  notificacoes            Notificacao[]
  larTemporariosAprovados LarTemporario[] @relation("AprovadorLarTemporario") // NOVO CAMPO
}

enum Role {
  ADMIN
  ONG
  PUBLICO
}

model Admin {
  id      Int     @id
  nome    String
  account Account @relation(fields: [id], references: [id], onDelete: Cascade)
}

model Publico {
  id      Int     @id
  account Account @relation(fields: [id], references: [id], onDelete: Cascade)
}

model Ong {
  id          Int     @id
  nome        String? // Seguindo a SUA padronização
  cnpj        String?
  descricao   String?
  cep         String?
  rua         String?
  numero      String?
  complemento String?
  bairro      String?
  cidade      String?
  estado      String?

  doacoes        Doacao[]
  larTemporarios LarTemporario[]
  account        Account         @relation(fields: [id], references: [id], onDelete: Cascade)
}

model Animal {
  id              Int          @id @default(autoincrement())
  nome            String
  especie         String
  raca            String?
  idade           Int?
  status          StatusAdocao @default(DISPONIVEL)
  porte           String?
  sexo            String?
  descricao       String?
  photoURL        String?
  corPredominante String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Detalhes do Resgate
  data_resgate          DateTime? @map("dataResgate")
  local_estado          String?
  local_cidade          String?
  local_numero          String?
  tinha_filhotes        Boolean?  @map("tinhaFilhotes")
  tinha_coleira         Boolean?  @map("tinhaColeira")
  motivo_nao_disponivel String?   @map("motivoNaoDisponivel")
  local_atual           String?   @map("localAtual")
  imagem_resgate_url    String?   @map("imagemResgateURL") // Segunda Imagem

  cuidados_veterinarios String?   @map("cuidadosVeterinarios")
  vermifugado           Boolean?
  data_vermifugado      DateTime? @map("dataVermifugado")
  vacinado              Boolean?
  vacinas_texto         String?   @map("vacinasTexto")
  castrado              Boolean?
  data_castrado         DateTime? @map("dataCastrado")
  testado_doencas       Boolean?  @map("testadoDoencas")
  testes_texto          String?   @map("testesTexto")
  resultados_testes     String?   @map("resultadosTestes")

  sociabilidade String?

  ficha Ficha? @relation("AnimalFicha")

  accountId Int
  account   Account @relation(fields: [accountId], references: [id])

  favoritos Favorito[]

  larTemporarios LarTemporario[] // relação inversa
  pedidosAdocao  PedidoAdocao[]  @relation("AnimalPedidos")
}

model Notificacao {
  id          String   @id @default(uuid())
  accountId   Int // era String → agora Int
  titulo      String
  mensagem    String
  lida        Boolean  @default(false)
  tipo        String?
  dataCriacao DateTime @default(now())

  account Account @relation(fields: [accountId], references: [id])
}

model Doacao {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  ongId     Int
  valor     Decimal
  createdAt DateTime @default(now())

  usuario Account @relation(fields: [usuarioId], references: [id])
  ong     Ong     @relation(fields: [ongId], references: [id])
}

model LarTemporario {
  id                     Int      @id @default(autoincrement())
  usuarioId              Int
  usuario                Account  @relation(fields: [usuarioId], references: [id])

  nomeCompleto           String
  cpf                    String
  email                  String
  telefone               String

  endereco               Json

  tipoMoradia            String?
  quintal                Boolean
  porteAnimal            String?
  tipoAnimal             String?
  outrosAnimais          Boolean
  administraMedicamentos Boolean

  levarVeterinario       Boolean
  arcarCustos            Boolean
  ajudaSuprimentos       Boolean

  periodoDisponibilidade String

  declaroVerdade         Boolean
  declaroLido            Boolean

  status                 String   @default("PENDENTE")
}

model Ficha {
  id             Int          @id @default(autoincrement())
  nome           String
  photoURL       String?
  especie        String
  raca           String?
  sexo           String?
  porte          String?
  dataNascimento DateTime?
  idade          Int?
  peso           Float?
  status         StatusAdocao @default(DISPONIVEL)

  // Saude
  saude          String?
  vacinas        String?
  vermifugos     String?
  castrado       Boolean   @default(false)
  alergias       String?
  medicacoes     String?
  ultimaConsulta DateTime?
  microchip      String?   @unique

  // Comportamento
  temperamento          String
  socializacao          String?
  cuidados              String?
  nivelEnergia          Int?
  conviveCom            String?
  necessidadesEspeciais String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy Int?

  animalId Int    @unique
  animal   Animal @relation("AnimalFicha", fields: [animalId], references: [id])

  @@map("fichas")
}

enum StatusAdocao {
  PERDIDO
  ENCONTRADO
  DISPONIVEL
  ADOTADO 
}

model PedidoAdocao {
  id          Int      @id @default(autoincrement())
  status      StatusPedido @default(PENDENTE)
  dataPedido  DateTime @default(now())

  animalId    Int
  animal      Animal   @relation("AnimalPedidos", fields: [animalId], references: [id])

  candidatoId Int
  account     Account  @relation("CandidatoPedidos", fields: [candidatoId], references: [id])

  formulario  FormularioAdocao? 

  @@map("pedidos_adocao")
}

model FormularioAdocao {
  id              Int     @id @default(autoincrement())
  pedidoAdocaoId  Int     @unique // Relação 1:1 obrigatória
  pedido          PedidoAdocao @relation(fields: [pedidoAdocaoId], references: [id], onDelete: Cascade)

  tipoMoradia     String 
  possuiQuintal   Boolean
  quintalTelado   Boolean?
  janelasTeladas  Boolean? 
  moradiaPropria  Boolean

  pessoasNaCasa   Int
  todosConcordam  Boolean
  criancasEmCasa  Boolean
  alergias        Boolean

  horasSozinho    Int     
  rotinaPasseios  String? 
  quemCuidara     String  
  
  possuiOutrosAnimais Boolean
  historicoAnimais    String? 

  teveAnimaisAntes    Boolean
  temVeterinario      Boolean?
  
  cienteCustos        Boolean 

  motivoAdocao        String  
  observacoes         String?

  createdAt       DateTime @default(now())

  @@map("formularios_adocao")
}

model Favorito {
  usuarioId Int
  animalId  Int
  createdAt DateTime @default(now())

  usuario Account @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  animal  Animal  @relation(fields: [animalId], references: [id], onDelete: Cascade)

  // Essa chave composta impede que o usuário favorite o mesmo animal 2 vezes
  @@id([usuarioId, animalId])
}

enum StatusPedido {
  PENDENTE
  APROVADO
  RECUSADO
}
